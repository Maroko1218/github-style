{{ $firstBracket := "\\[\\[" }}
{{ $lastBracket := "\\]\\]" }}

{{ $wikiregex := "\\[\\[([^/]+?)\\]\\]" }}
{{ $page := .Page }}

{{ $wikilinks := .Content | findRE $wikiregex }}

{{ $.Scratch.Add "content" .RawContent }}

{{ range $wikilinks }}

	{{ $content := . | replaceRE $wikiregex "$1" }}
	{{ $content := $content | replaceRE "\\?" "\\?" }}
	{{ $pageexists := $page.GetPage $content}}
	{{ if $pageexists }}

		{{ $wikilink :=  printf "%s%s%s" $firstBracket $content $lastBracket }}

		{{ $anchorized := $content | anchorize }}

		{{ $rel := relref $page $anchorized }}

		{{ $link := printf "%s%s%s%s%s" "[" $content "]({{< relref path=\"" $rel "\">}})"  }}


		{{ $noteContent := $.Scratch.Get "content" | replaceRE $wikilink $link }}
		{{ $.Scratch.Set "content" $noteContent }}
	{{ end }}
{{ end }}

{{ $content := .Scratch.Get "content" }}
{{ $content | markdownify }}